{% extends "base.html" %}

{% block title %}Dashboard - Canventory{% endblock %}
{% block body_class %}app-page{% endblock %}

{% include "header.html" %}

{% block content %}

<!-- Stats Bar -->
<section class="stats-bar">
    <a href="/web/dashboard" class="stat-card {% if not status %}active{% endif %}">
        <div class="stat-icon">ğŸ“¦</div>
        <div class="stat-content">
            <span class="stat-value" id="stat-total">{{ stats.total_items }}</span>
            <span class="stat-label">Total Items</span>
        </div>
    </a>
    <a href="/web/dashboard?status=fresh" class="stat-card {% if status == 'fresh' %}active{% endif %}">
        <div class="stat-icon">âœ…</div>
        <div class="stat-content">
            <span class="stat-value" id="stat-fresh">{{ stats.expiration_summary.fresh or 0 }}</span>
            <span class="stat-label">Fresh</span>
        </div>
    </a>
    <a href="/web/dashboard?status=warning" class="stat-card warning {% if status == 'warning' %}active{% endif %}">
        <div class="stat-icon">âš ï¸</div>
        <div class="stat-content">
            <span class="stat-value" id="stat-warning">{{ alerts.warning_count }}</span>
            <span class="stat-label">Expiring Soon</span>
        </div>
    </a>
    <a href="/web/dashboard?status=critical" class="stat-card critical {% if status == 'critical' %}active{% endif %}">
        <div class="stat-icon">ğŸš¨</div>
        <div class="stat-content">
            <span class="stat-value" id="stat-critical">{{ alerts.critical_count }}</span>
            <span class="stat-label">Critical</span>
        </div>
    </a>
    <a href="/web/dashboard?status=expired" class="stat-card expired {% if status == 'expired' %}active{% endif %}">
        <div class="stat-icon">âŒ</div>
        <div class="stat-content">
            <span class="stat-value" id="stat-expired">{{ alerts.expired_count }}</span>
            <span class="stat-label">Expired</span>
        </div>
    </a>
</section>

<!-- Toolbar -->
<section class="toolbar">
    <form class="search-box" method="get" action="/web/dashboard">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8" />
            <path d="M21 21l-4.35-4.35" />
        </svg>
        <input type="text" name="search" placeholder="Search items..." value="{{ search or '' }}">
    </form>
    <div class="filter-group">
        <form id="filter-form" method="get" action="/web/dashboard">
            <input type="hidden" name="search" value="{{ search or '' }}">
            <select name="category" class="filter-select" onchange="this.form.submit()">
                <option value="">All Categories</option>
                {% for cat in categories %}
                <option value="{{ cat.value }}" {% if category==cat.value %}selected{% endif %}>{{ cat.label }}</option>
                {% endfor %}
            </select>
            <select name="sort" class="filter-select" onchange="this.form.submit()">
                <option value="expiration_asc" {% if sort=='expiration_asc' %}selected{% endif %}>ğŸ“… Expires Soon First
                </option>
                <option value="expiration_desc" {% if sort=='expiration_desc' %}selected{% endif %}>ğŸ“… Expires Later
                    First</option>
                <option value="name_asc" {% if sort=='name_asc' %}selected{% endif %}>ğŸ”¤ Name A-Z</option>
                <option value="name_desc" {% if sort=='name_desc' %}selected{% endif %}>ğŸ”¤ Name Z-A</option>
                <option value="created_desc" {% if sort=='created_desc' %}selected{% endif %}>ğŸ• Newest First</option>
                <option value="created_asc" {% if sort=='created_asc' %}selected{% endif %}>ğŸ• Oldest First</option>
            </select>
        </form>
    </div>
    <a href="/web/items/new" class="btn btn-primary">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14" />
        </svg>
        <span>Add Item</span>
    </a>
</section>

<!-- Items Grid -->
<main class="items-container">
    {% if status %}
    <div class="filter-header">
        <h2>
            {% if status == 'fresh' %}âœ… Fresh Items
            {% elif status == 'warning' %}âš ï¸ Expiring Soon
            {% elif status == 'critical' %}ğŸš¨ Critical Items
            {% elif status == 'expired' %}âŒ Expired Items
            {% endif %}
        </h2>
        <a href="/web/dashboard" class="btn btn-ghost btn-sm">Clear Filter âœ•</a>
    </div>
    {% endif %}
    {% if items %}
    <div class="items-grid">
        {% for item in items %}
        <article class="item-card">
            <div class="item-image">
                {% if item.has_image %}
                <img src="/web/items/{{ item.id }}/image?thumbnail=true" alt="{{ item.name }}" loading="lazy">
                {% else %}
                <span class="item-image-placeholder">{{ category_icons.get(item.category, 'ğŸ“¦') }}</span>
                {% endif %}
                <span class="item-status-badge status-{{ item.expiration_status.value }}">
                    {{ item.expiration_status.value }}
                </span>
            </div>
            <div class="item-content">
                <div class="item-header">
                    <h3 class="item-name">{{ item.name }}</h3>
                    <span class="item-quantity">Ã—{{ item.quantity }}</span>
                </div>
                <div class="item-category">{{ category_icons.get(item.category, 'ğŸ“¦') }} {{ item.category | replace('_',
                    ' ') | title }}</div>
                <div class="item-expiration {{ item.expiration_status if item.expiration_status != 'fresh' else '' }}">
                    <span>ğŸ“…</span>
                    <span>
                        {% if item.days_until_expiration < 0 %} Expired {{ (-item.days_until_expiration) }} day(s) ago
                            ({{ item.expiration_date.strftime('%d %b %Y') }}) {% elif item.days_until_expiration==0 %}
                            Expires today ({{ item.expiration_date.strftime('%d %b %Y') }}) {% elif
                            item.days_until_expiration==1 %} Expires tomorrow ({{ item.expiration_date.strftime('%d %b
                            %Y') }}) {% else %} Expires in {{ item.days_until_expiration }} days ({{
                            item.expiration_date.strftime('%d %b %Y') }}) {% endif %} </span>
                </div>
                {% if item.description %}
                <p class="item-description">{{ item.description }}</p>
                {% endif %}
            </div>
            <div class="item-actions">
                <a href="/web/items/{{ item.id }}/edit" class="btn btn-ghost btn-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                    </svg>
                    Edit
                </a>
                <form method="post" action="/web/items/{{ item.id }}/delete" class="delete-form" data-confirm="delete"
                    data-confirm-item="{{ item.name }}" data-confirm-type="delete">
                    <button type="submit" class="btn btn-ghost btn-sm">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="3 6 5 6 21 6" />
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                        </svg>
                        Delete
                    </button>
                </form>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">ğŸ¥«</div>
        <h3>Your pantry is empty</h3>
        <p>Start by adding some items to track</p>
        <a href="/web/items/new" class="btn btn-primary">Add Your First Item</a>
    </div>
    {% endif %}
</main>


<!-- Pagination -->
{% if total_pages > 1 %}
<section class="pagination">
    {% if page > 1 %}
    <a href="/web/dashboard?page={{ page - 1 }}&search={{ search or '' }}&category={{ category or '' }}&status={{ status or '' }}&sort={{ sort or 'expiration_asc' }}"
        class="btn btn-ghost">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6" />
        </svg>
        Previous
    </a>
    {% else %}
    <button class="btn btn-ghost" disabled>Previous</button>
    {% endif %}

    <span class="page-info">Page {{ page }} of {{ total_pages }}</span>

    {% if page < total_pages %} <a
        href="/web/dashboard?page={{ page + 1 }}&search={{ search or '' }}&category={{ category or '' }}&status={{ status or '' }}&sort={{ sort or 'expiration_asc' }}"
        class="btn btn-ghost">
        Next
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6" />
        </svg>
        </a>
        {% else %}
        <button class="btn btn-ghost" disabled>Next</button>
        {% endif %}
</section>
{% endif %}

{% endblock %}
